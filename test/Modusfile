# create basic image and install git
base_image("gen") :-
  from("ubuntu:14.04"),
  run("apt-get update && apt-get install -y git").
  
base_image("cer") :-
  from("ubuntu"),
  run("apt-get update && apt-get install -y git").

# install wget
install_wget :-
  run("apt-get install -y wget").

# install python, pip, python-venv
install_python :-
  run("apt-get install -y python3 python3-pip python3-venv").
 
from_wget :- 
  from("cvisionai/wget").
  

copy_patchprocess("gen") :-
  copy("./f1x-genprog-icse12", "/").

copy_patchprocess("cer") :-
  run("mkdir cerberus"),
  copy("./cerberus", "/cerberus").
  
prepare("gen") :-
  run("./bootstrap_installDependency.sh"),
  run("./bootstrap_CMake.sh"),
  run("./bootstrap_f1x.sh"),
  run("./bootstrap_prophet.sh").

prepare("cer") :-
  (
    install_python,
    # run("python3 -m venv cer"),
    # run(". cer/bin/activate"),
    run("pip3 install -r requirements.txt"),
    run("apt-get install build-essential python3-dev"),
    run("pip3 install Cython"),
    run(". activate")
    # run("python3 setup.py install")
  )::in_workdir("/cerberus").
  
patch3(target) :-
  base_image(target),
  install_wget,
  copy_patchprocess(target),
  prepare(target).
  


